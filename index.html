<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EcoMemori (Juego de Memoria con Niveles)</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

Â  Â  <audio id="musicaFondo" loop autoplay>
Â  Â  <source src="musica_fondo.mp3" type="audio/mpeg">
Â  Â  Tu navegador no soporta el elemento de audio.
Â  </audio>

Â  Â  <div id="menu">
Â  Â  <h1>ğŸ§  EcoMemori ğŸ§ </h1>
Â  Â  <p>Por favor, regÃ­strate antes de jugar:</p>
Â  Â  <input type="text" id="nombre" placeholder="Tu nombre" required><br>
Â  Â  <input type="number" id="edad" placeholder="Tu edad" required><br>
Â  Â  <button onclick="iniciarRegistro()">Siguiente</button>
Â  </div>

Â  Â  <div id="menuNiveles" style="display:none;" class="menu-contenedor">
Â  Â  <h2>Selecciona el Nivel</h2>
Â  Â  <button onclick="iniciarJuego(1)">Nivel 1 (4x4, BÃ¡sico)</button>
Â  Â  <button onclick="iniciarJuego(2)">Nivel 2 (6x4, Intermedio)</button>
Â  Â  <button onclick="iniciarJuego(3)">Nivel 3 (8x4, 90s â±ï¸)</button>
Â  Â  <button onclick="iniciarJuego(4)">Nivel 4 (8x5, 120s â±ï¸)</button>
Â  Â  <button onclick="document.getElementById('juego').style.display='none'; document.getElementById('menuNiveles').style.display='none'; document.getElementById('menu').style.display='flex';">â† Volver al Registro</button>
Â  </div>

Â  Â  <div id="juego">
Â  Â  <h1>EcoMemori</h1>
Â  Â  <div id="saludo"></div>
Â  Â  <div id="info">
Â  Â  Â  <div id="nivel-actual">Nivel: 1</div>
Â  Â  Â  <div>â±ï¸ Tiempo: <span id="tiempo">0</span> s</div>
Â  Â  Â  <div>ğŸ” Intentos: <span id="intentos">0</span></div>
Â  Â  </div>

Â  Â  <div id="tablero"></div>
Â  Â  <div id="recompensa-msg"></div>

Â  Â  <button onclick="reiniciar()">Reiniciar</button>

Â  Â  Â  Â  <div id="records">
Â  Â  Â  <h2>ğŸ† RÃ©cords</h2>
Â  Â  Â  <table id="tablaRecords">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th>Jugador</th>
Â  Â  Â  Â  Â  Â  <th>Nivel</th>
Â  Â  Â  Â  Â  Â  <th>Tiempo</th>
Â  Â  Â  Â  Â  Â  <th>Intentos</th>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  </table>
Â  Â  </div>
Â  </div>

<script>
Â  const todosEmojis = [
Â  Â  'ğŸ¶','ğŸ±','ğŸ¸','ğŸµ','ğŸ¦Š','ğŸ¼','ğŸ¯','ğŸ¦', 'ğŸ¦„', 'ğŸ³', 'ğŸ', 'ğŸ¦‰', 
Â  Â  'ğŸ¢', 'ğŸ', 'ğŸ˜', 'ğŸ¦’', 'ğŸ¦“', 'ğŸ¦˜', 'ğŸ¦¥', 'ğŸ¦©'
Â  ];
Â  let cartas = [];
Â  let primera = null;
Â  let segunda = null;
Â  let bloqueo = false;
Â  let intentos = 0;
Â  let tiempo = 0;
Â  let timer = null;
Â  let jugador = '';
Â  let nivel = 1; 
Â  const TABLERO = document.getElementById('tablero');
Â  const RECOMPENSA_MSG = document.getElementById('recompensa-msg');
Â  const MUSICA = document.getElementById('musicaFondo'); 
Â  let limiteTiempoGlobal = 0; 
Â  // Lista histÃ³rica para calcular el progreso (simula una tabla en Firebase/DB)
Â  let historialPartidas = JSON.parse(localStorage.getItem('historialPartidas')) || [];


Â  window.onload = () => {
Â  Â  mostrarRecords();
Â  Â  mostrarEstadisticasGlobales();
Â  Â  try {
Â  Â  Â  MUSICA.volume = 0.4; 
Â  Â  Â  MUSICA.play();
Â  Â  } catch (e) {
Â  Â  Â  console.log("MÃºsica de fondo esperando interacciÃ³n del usuario.");
Â  Â  }
Â  };

Â  // Manejar Registro y reproducir mÃºsica al primer clic
Â  function iniciarRegistro() {
Â  Â  const nombre = document.getElementById('nombre').value.trim();
Â  Â  const edad = document.getElementById('edad').value.trim();

Â  Â  if (nombre === '' || edad === '') {
Â  Â  Â  alert('Por favor ingresa tu nombre y edad.');
Â  Â  Â  return;
Â  Â  }
    
Â  Â  try {
Â  Â  Â  MUSICA.play(); 
Â  Â  } catch (e) {
Â  Â  Â  console.log("Audio iniciado despuÃ©s del primer clic.");
Â  Â  }

Â  Â  jugador = nombre;
Â  Â  document.getElementById('saludo').textContent = `ğŸ‘‹ Bienvenido, ${jugador} (${edad} aÃ±os)`;
Â  Â  document.getElementById('menu').style.display = 'none';
Â  Â  document.getElementById('menuNiveles').style.display = 'flex'; 
Â  Â  
Â  Â  if (timer) clearInterval(timer);
Â  }
Â  
Â  // Iniciar Juego desde la selecciÃ³n de nivel
Â  function iniciarJuego(nivelSeleccionado) {
Â  Â  nivel = nivelSeleccionado;
Â  Â  document.getElementById('menuNiveles').style.display = 'none'; 
Â  Â  document.getElementById('juego').style.display = 'flex'; 
Â  Â  iniciarNivel();
Â  }

Â  // ======== LÃ³gica para iniciar el Nivel (FASE DE MEMORIZACIÃ“N) ========
Â  function iniciarNivel() {
Â  Â  RECOMPENSA_MSG.innerHTML = '';
    
    // ConfiguraciÃ³n Inicial
    bloqueo = true; 
    if (timer) clearInterval(timer);
Â  Â  intentos = 0;
Â  Â  tiempo = 0;
Â  Â  document.getElementById('intentos').textContent = intentos;
Â  Â  document.getElementById('tiempo').textContent = tiempo;
    
Â  Â  let emojisNivel;
Â  Â  let clasesTablero;
    limiteTiempoGlobal = 0; 

Â  Â  if (nivel === 1) {
Â  Â  Â  emojisNivel = todosEmojis.slice(0, 8); 
Â  Â  Â  clasesTablero = 'nivel-1'; 
Â  Â  } else if (nivel === 2) {
Â  Â  Â  emojisNivel = todosEmojis.slice(0, 12); 
Â  Â  Â  clasesTablero = 'nivel-2'; 
Â  Â  } else if (nivel === 3) {
Â  Â  Â  emojisNivel = todosEmojis.slice(0, 16); 
Â  Â  Â  clasesTablero = 'nivel-3'; 
        limiteTiempoGlobal = 90; 
Â  Â  } else if (nivel === 4) {
Â  Â  Â  emojisNivel = todosEmojis.slice(0, 20); 
Â  Â  Â  clasesTablero = 'nivel-4'; 
        limiteTiempoGlobal = 120; 
Â  Â  } else {
Â  Â  Â  alert(`Â¡Has completado el juego, ${jugador}! Â¡Elige un nuevo desafÃ­o!`);
Â  Â  Â  document.getElementById('juego').style.display = 'none';
Â  Â  Â  document.getElementById('menuNiveles').style.display = 'flex';
Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // Actualiza el contador de tiempo para mostrar el lÃ­mite si existe
Â  Â  let textoTiempo = limiteTiempoGlobal > 0 ? `${limiteTiempoGlobal} s` : '0 s';
Â  Â  document.getElementById('tiempo').textContent = textoTiempo;
Â  Â  document.getElementById('nivel-actual').textContent = `Nivel: ${nivel}` + (limiteTiempoGlobal > 0 ? ` (LÃ­mite: ${limiteTiempoGlobal}s)` : '');
Â  Â  
Â  Â  TABLERO.className = ''; 
Â  Â  TABLERO.classList.add(clasesTablero);

Â  Â  const duplicadas = [...emojisNivel, ...emojisNivel];
Â  Â  cartas = duplicadas.sort(() => Math.random() - 0.5);
Â  Â  TABLERO.innerHTML = '';

Â  Â  // Crear y mostrar cartas para MEMORIZACIÃ“N
Â  Â  cartas.forEach((emoji, index) => {
Â  Â  Â  const carta = document.createElement('div');
Â  Â  Â  carta.classList.add('carta'); 
Â  Â  Â  carta.dataset.valor = emoji;
Â  Â  Â  carta.textContent = emoji; 
Â  Â  Â  carta.onclick = () => voltear(carta);
Â  Â  Â  TABLERO.appendChild(carta);
Â  Â  });
    
    // Muestra el botÃ³n para iniciar el juego en TODOS los niveles
    RECOMPENSA_MSG.innerHTML = `
        <div class="recompensa" style="background: #34d399;">
            ğŸ‘€ Â¡MEMORIZA LOS PARES!
            <button onclick="iniciarJuegoActivo()" style="margin-top: 10px;">INICIAR JUEGO</button>
        </div>`;
Â  }


Â  // ======== FUNCIÃ“N PARA INICIAR EL JUEGO ACTIVO (AL PRESIONAR EL BOTÃ“N) ========
Â  function iniciarJuegoActivo() {
Â  Â  // 1. Ocultar todas las cartas
Â  Â  document.querySelectorAll('.carta').forEach(c => {
Â  Â  Â  Â  c.textContent = '';
Â  Â  Â  Â  c.classList.add('oculta');
Â  Â  });
Â  Â  
Â  Â  RECOMPENSA_MSG.innerHTML = ''; // Limpiar mensaje de memorizaciÃ³n
Â  Â  bloqueo = false; // Desbloquear clics para el jugador

Â  Â  // Reinicia el tiempo si el nivel tiene lÃ­mite; de lo contrario, inicia en 0
Â  Â  tiempo = limiteTiempoGlobal > 0 ? limiteTiempoGlobal : 0;
Â  Â  
Â  Â  // Iniciar el temporizador del juego (Cuenta regresiva o progresiva)
Â  Â  timer = setInterval(() => {
        if (limiteTiempoGlobal > 0) {
            // Cuenta Regresiva (Nivel 3 y 4)
            tiempo--;
            document.getElementById('tiempo').textContent = `${tiempo} s`;

            if (tiempo <= 0) {
                clearInterval(timer);
                bloqueo = true;
                RECOMPENSA_MSG.innerHTML = `<div class="recompensa" style="background: #dc2626;">âŒ› Â¡Tiempo Agotado! Game Over. IntÃ©ntalo de nuevo.</div>`;
                setTimeout(() => {
                    RECOMPENSA_MSG.innerHTML = '';
                    document.getElementById('juego').style.display = 'none';
Â  Â                  document.getElementById('menuNiveles').style.display = 'flex';
                }, 3000);
            }
        } else {
            // Cuenta Progresiva (Nivel 1 y 2)
            tiempo++;
            document.getElementById('tiempo').textContent = `${tiempo} s`;
        }
Â  Â  }, 1000);
Â  }

Â  // LÃ³gica del juego (voltear)
Â  function voltear(carta) {
Â  Â  if (bloqueo || carta === primera || !carta.classList.contains('oculta')) return; 
Â  Â  
Â  Â  carta.textContent = carta.dataset.valor;
Â  Â  carta.classList.remove('oculta');

Â  Â  if (!primera) {
Â  Â  Â  primera = carta;
Â  Â  } else {
Â  Â  Â  segunda = carta;
Â  Â  Â  bloqueo = true;
Â  Â  Â  intentos++;
Â  Â  Â  document.getElementById('intentos').textContent = intentos;

Â  Â  Â  if (primera.dataset.valor === segunda.dataset.valor) {
Â  Â  Â  Â  primera = null;
Â  Â  Â  Â  segunda = null;
Â  Â  Â  Â  bloqueo = false;
Â  Â  Â  Â  
Â  Â  Â  Â  if (document.querySelectorAll('.oculta').length === 0) {
Â  Â  Â  Â  Â  clearInterval(timer);
Â  Â  Â  Â  Â  guardarRecord(jugador, tiempo, intentos, nivel);
Â  Â  Â  Â  Â  setTimeout(() => mostrarRecompensa(), 300);
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  primera.textContent = '';
Â  Â  Â  Â  Â  segunda.textContent = '';
Â  Â  Â  Â  Â  primera.classList.add('oculta');
Â  Â  Â  Â  Â  segunda.classList.add('oculta');
Â  Â  Â  Â  Â  primera = null;
Â  Â  Â  Â  Â  segunda = null;
Â  Â  Â  Â  Â  bloqueo = false;
Â  Â  Â  Â  }, 800);
Â  Â  Â  }
Â  Â  }
Â  }

Â  // Recompensa y Avance/Fin 
Â  function mostrarRecompensa() {
Â  Â  let tiempoRegistrado = limiteTiempoGlobal > 0 ? tiempo : tiempo;
Â  Â  let mensajeTiempo = limiteTiempoGlobal > 0 ? `Tiempo restante: ${tiempoRegistrado}s` : `${tiempoRegistrado} segundos`;

Â  Â  let mensaje = `ğŸ‰ Â¡Felicidades, ${jugador}! Nivel ${nivel} completado en ${intentos} intentos y ${mensajeTiempo}.`;
Â  Â  
Â  Â  if (nivel < 4) { 
Â  Â  Â  mensaje += `<br>Â¡**Recompensa**! Has desbloqueado el **Nivel ${nivel + 1}**.`;
Â  Â  Â  nivel++; 
Â  Â  Â  setTimeout(() => iniciarJuego(nivel), 4000); 
Â  Â  } else {
Â  Â  Â  mensaje += `<br>Â¡**RECOMPENSA MÃXIMA**! Has completado todos los desafÃ­os.`;
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  document.getElementById('juego').style.display = 'none';
Â  Â  Â  Â  document.getElementById('menuNiveles').style.display = 'flex';
Â  Â  Â  }, 5000);
Â  Â  }
Â  Â  
Â  Â  RECOMPENSA_MSG.innerHTML = `<div class="recompensa">${mensaje}</div>`;
Â  Â  setTimeout(() => RECOMPENSA_MSG.innerHTML = '', nivel < 4 ? 4000 : 5000);
Â  }

Â  // ======== FUNCIÃ“N MODIFICADA: Guardar RÃ©cords y Partida HistÃ³rica ========
Â  function guardarRecord(nombre, tiempo, intentos, nivel) {
Â  Â  // 1. Registrar el rÃ©cord en el TOP 5 (pantalla de rÃ©cords)
Â  Â  let records = JSON.parse(localStorage.getItem('records')) || [];
Â  Â  let tiempoARegistrar = limiteTiempoGlobal > 0 ? tiempo : tiempo; 

Â  Â  records.push({ nombre, tiempo: tiempoARegistrar, intentos, nivel }); 
Â  Â  records.sort((a, b) => {
Â  Â  Â  if (a.nivel !== b.nivel) return b.nivel - a.nivel; 
Â  Â  Â  if (a.nivel >= 3) return b.tiempo - a.tiempo; 
Â  Â  Â  return a.tiempo - b.tiempo;
Â  Â  });
    
Â  Â  if (records.length > 5) records = records.slice(0, 5);
Â  Â  localStorage.setItem('records', JSON.stringify(records));

    // 2. Registrar la partida completa en el historial (simulaciÃ³n de la tabla Partidas en la DB)
    historialPartidas.push({
        jugador: nombre,
        nivel: nivel,
        intentos: intentos,
        tiempo: tiempoARegistrar,
        tipo: limiteTiempoGlobal > 0 ? 'Contrarreloj' : 'EstÃ¡ndar',
        fecha: new Date().toLocaleDateString() 
    });
    localStorage.setItem('historialPartidas', JSON.stringify(historialPartidas));

Â  Â  mostrarRecords();
Â  Â  mostrarEstadisticasGlobales();
Â  }

Â  // ======== FUNCIÃ“N MODIFICADA: Mostrar RÃ©cords y EstadÃ­sticas Globales ========
Â  function mostrarRecords() {
Â  Â  const tbody = document.querySelector('#tablaRecords tbody');
Â  Â  tbody.innerHTML = '';
Â  Â  const records = JSON.parse(localStorage.getItem('records')) || [];
Â  Â  records.forEach(r => {
Â  Â  Â  Â  let tiempoMostrado = r.tiempo;
Â  Â  Â  Â  if (r.nivel >= 3) {
Â  Â  Â  Â  Â  tiempoMostrado = `${r.tiempo}s (restante)`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  tiempoMostrado = `${r.tiempo}s`;
Â  Â  Â  Â  }

Â  Â  Â  Â  const fila = `<tr><td>${r.nombre}</td><td>${r.nivel}</td><td>${tiempoMostrado}</td><td>${r.intentos}</td></tr>`;
Â  Â  Â  Â  tbody.innerHTML += fila;
Â  Â  });
Â  }
    
Â  function mostrarEstadisticasGlobales() {
    // Calculamos el promedio Puntaje y Partidas Jugadas (Requisito Funcional)
    const totalPartidas = historialPartidas.length;
    let totalIntentos = 0;
    
    historialPartidas.forEach(p => {
        totalIntentos += p.intentos;
    });
    
    const promedioIntentos = totalPartidas > 0 ? (totalIntentos / totalPartidas).toFixed(2) : 0;
    
    // AÃ±adimos estas estadÃ­sticas debajo de la tabla de rÃ©cords
    const recordsDiv = document.getElementById('records');
    
    // Limpiamos estadÃ­sticas anteriores si existen
    let statsDiv = document.getElementById('globalStats');
    if (!statsDiv) {
        statsDiv = document.createElement('div');
        statsDiv.id = 'globalStats';
        recordsDiv.appendChild(statsDiv);
    }
    
    statsDiv.innerHTML = `
        <h3 style="margin-top: 15px; font-size: 16px;">ğŸ“Š Progreso del Usuario</h3>
        <p>Partidas Jugadas: <b>${totalPartidas}</b></p>
        <p>Promedio de Intentos: <b>${promedioIntentos}</b></p>
    `;
    }


Â  function reiniciar() {
Â  Â  clearInterval(timer);
Â  Â  document.getElementById('juego').style.display = 'none';
Â  Â  document.getElementById('menuNiveles').style.display = 'flex';
Â  }
</script>
</body>
</html>